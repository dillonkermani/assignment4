[[extend 'layout.html']]

<style>
[v-cloak] {
     display: none;
}
</style>


<div class="section" id="app" v-cloak>
  <!-- Put here your Vue.js template -->
  <div class="container">
    <h1 class="title">Contacts</h1>
    <div><button class="button is-success" id="add_button" @click="add_contact">Add Contact</button></div>


      <!-- Add Contact Modal -->
      <div class="card-content">
        <div class="media">
          <div class="media-left">
            <figure class="photo image is-96x96" @click="triggerFileInput">
              <img class="new_photo" :src="new_contact.image || 'https://bulma.io/assets/images/placeholders/96x96.png'"/>
              <input ref="fileInput" id="file-input" type="file" style="display: none"
                     accept=".jpg, .png, .jpeg, .gif, .bmp, .tif, .tiff|image/*"
                     @change="handleFileChange">
            </figure>
          </div>
          <div class="media-content">
            <p class="title person-name">
              <input type="text" class="input is-4 title" 
                    name='new_name'
                    value=""
                    v-model="new_contact.name"
              />
            </p>
            <p class="subtitle person-affiliation">
              <input type="text" class="input is-6" 
                    name="new_affiliation"
                    v-model="new_contact.affiliation"
              />
            </p>
          </div>
          <div class="media-right"><i class="delete-button has-text-danger fa-solid fa-trash-can trash"></i></div>
        </div>
          <textarea class="textarea"
                    name="new_description"
                    v-model="new_contact.description"
            ></textarea> 
        </div>



        <!-- Edit Contact Modal -->
        <div class="card contact mt-4" v-for="contact in contacts" :key="contact.id">
          <div class="card-content">
              <div class="media">
                  <div class="media-left">
                      <figure class="photo image is-96x96" @click="triggerFileInput(contact)">
                          <img class="photo" :src="contact.image || 'https://bulma.io/assets/images/placeholders/96x96.png'">
                          <input type="file" id="file-input" :ref="'fileInput' + contact.id" @change="handleFileChange($event, contact)" style="display:none">
                      </figure>
                  </div>
                  <div class="media-content">
                      <p class="title person-name">
                          <input class="input" name="name" :readonly="!contact.editing" @focus="enableEditing(contact)" @blur="saveChanges(contact)" v-model="contact.name">
                      </p>
                      <p class="subtitle person-affiliation">
                          <input class="input" name="affiliation" :readonly="!contact.editing" @focus="enableEditing(contact)" @blur="saveChanges(contact)" v-model="contact.affiliation">
                      </p>
                  </div>
                  <div class="media-right">
                      <button class="delete_button" @click="delete_contact(contact)">
                          <i class="delete-button has-text-danger fa-solid fa-trash-can"></i>
                      </button>
                  </div>
              </div>
              <textarea class="textarea" name="description" :readonly="!contact.editing" @focus="enableEditing(contact)" @blur="saveChanges(contact)" v-model="contact.description">
              </textarea>
          </div>
      </div>
      

      </div>
    </div>
  </div>
</div>


[[block page_scripts]]
<!-- Loads the index-specific js for Vue -->
<script>
  let get_contacts_url = "[[=XML(get_contacts_url)]]";
  let add_contact_url = "[[=XML(add_contact_url)]]";
  let del_contact_url = "[[=XML(del_contact_url)]]";
  let update_contact_url = "[[=XML(update_contact_url)]]";

</script>

<script src="js/index.js"></script>
[[end]]
